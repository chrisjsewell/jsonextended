
[![Build Status](https://travis-ci.org/chrisjsewell/jsonextended.svg?branch=master)](https://travis-ci.org/chrisjsewell/jsonextended)


# JSON Extended

A python module to extend the json package; treating path structures, with nested directories and multiple .json files, as a single json.

It provides:

- Functions for decoding/encoding between the on-disk JSON structure and in-memory nested dictionary structure, including

    - on-disk indexing of the json structure (using the ijson package)
    - extended data type serialisation (numpy.ndarray, Decimals, pint.Quantities) 

- Functions for viewing and manipulating the nested dictionaries

    - including Javascript rendered, expandable tree in the Jupyter Notebook

- Units schema concept to apply and convert physical units (using the pint package)

- Parser abstract class for dealing with converting other file formats to JSON


## Example

### Data Folders JSONisation


```python
import jsonextended as ejson

path = ejson.get_test_path()
ejson.json_keys(path)
```




    ['dir1', 'dir2', 'dir3']




```python
jdict1 = ejson.json_to_dict(path)
ejson.dict_pprint(jdict1,depth=2)
```

    dir1: 
      dir1_1: {...}
      file1: {...}
      file2: {...}
    dir2: 
      file1: {...}
    dir3: 



```python
ejson.dict_to_html(jdict2,depth=2)
```




<style>
    .renderjson a              { text-decoration: none; }
    .renderjson .disclosure    { color: red;
                                 font-size: 125%; }
    .renderjson .syntax        { color: darkgrey; }
    .renderjson .string        { color: black; }
    .renderjson .number        { color: black; }
    .renderjson .boolean       { color: purple; }
    .renderjson .key           { color: royalblue; }
    .renderjson .keyword       { color: orange; }
    .renderjson .object.syntax { color: lightseagreen; }
    .renderjson .array.syntax  { color: lightseagreen; }
    </style><div id="37e54692-0cc1-469a-bd9f-911c498fb526" style="max-height: 600px; width:100%%;"></div>
                <script>
            require(["jsonextended/renderjson.js"], function() {
                document.getElementById("37e54692-0cc1-469a-bd9f-911c498fb526").appendChild(
                    renderjson.set_max_string_length(20)
                              //.set_icons(circled plus, circled minus)
                              .set_icons(String.fromCharCode(8853), String.fromCharCode(8854))
                              .set_sort_objects(true)
                              .set_show_to_level(2)({"units": {"distance": "angstrom", "energy": "au", "angle": "degree", "density": "g.cm^3"}, "initial": {"primitive": {"geometry": {"z/c": [0.384, 0.116, -0.384, -0.116, -0.386, -0.114, 0.386, 0.114, 0.361, 0.139, -0.361, -0.139, -0.381, -0.119, 0.381, 0.119, 0.4902, 0.0098, -0.4902, -0.0098, -0.2469, -0.2531, 0.2469, 0.2531, -0.4953, -0.0047, 0.4953, 0.0047, -0.25, 0.25], "atomic_number": [16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26], "y/b": [-0.03, -0.22, 0.03, 0.22, -0.475, 0.223, 0.475, -0.223, -0.02, 0.272, 0.02, -0.272, -0.47, -0.268, 0.47, 0.268, -0.2298, 0.0238, 0.2298, -0.0238, 0.137, -0.375, -0.137, 0.375, -0.217, -0.495, 0.217, 0.495, -0.378, 0.378], "label": ["S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE"], "y": [-0.856025, -0.856025, 0.856025, 0.856025, 2.5612268, -0.8628732, -2.5612268, 0.8628732, 0.8628732, 0.8628732, -0.8628732, -0.8628732, 0.8971142, -2.5269858, -0.8971142, 2.5269858, -0.7053646, -0.7053646, 0.7053646, 0.7053646, -0.8149358, 2.6091642, 0.8149358, -2.6091642, 0.9861408, -2.4379592, -0.9861408, 2.4379592, -2.5886196, 2.5886196], "x/a": [-0.22, -0.03, 0.22, 0.03, 0.223, -0.475, -0.223, 0.475, 0.272, -0.02, -0.272, 0.02, -0.268, -0.47, 0.268, 0.47, 0.0238, -0.2298, -0.0238, 0.2298, -0.375, 0.137, 0.375, -0.137, -0.495, -0.217, 0.495, 0.217, -0.378, 0.378], "assym": [true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "x": [-3.457389260668, 0.4233303275066, 3.457389260668, -0.4233303275066, 0.5505878964006, -3.449328963239, -0.5505878964006, 3.449328963239, -0.4582129497425, -2.575845983419, 0.4582129497425, 2.575845983419, -2.422421492931, -0.4763195739076, 2.422421492931, 0.4763195739076, -1.470033298071, -1.56402563509, 1.470033298071, 1.56402563509, -1.539375298805, -1.359365768034, 1.539375298805, 1.359365768034, 1.220902512867, 1.677838553972, -1.220902512867, -1.677838553972, 1.517029466581, -1.517029466581], "z": [4.36950161569, 1.319953613073, -4.36950161569, -1.319953613073, -4.392259436605, -1.297195792158, 4.392259436605, 1.297195792158, 4.107786675167, 1.581668553596, -4.107786675167, -1.581668553596, -4.335364884318, -1.354090344446, 4.335364884318, 1.354090344446, 5.57794190628, 0.1115133224838, -5.57794190628, -0.1115133224838, -2.809452991963, -2.8800022368, 2.809452991963, 2.8800022368, 5.742936107914, -0.05348087915038, -5.742936107914, 0.05348087915038, -2.844727614382, 2.844727614382], "id": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]}, "volume": 462.313764, "lattice_parameters": {"a": 6.85000559, "c": 12.8958, "b": 6.85000559, "beta": 114.050646, "alpha": 65.949354, "gamma": 120.017438}, "density": 4.65}, "crystallographic": {"geometry": {"z/c": [0.384, 0.116, -0.384, -0.116, -0.386, -0.114, 0.386, 0.114, 0.361, 0.139, -0.361, -0.139, -0.381, -0.119, 0.381, 0.119, 0.4902, 0.0098, -0.4902, -0.0098, -0.2469, -0.2531, 0.2469, 0.2531, -0.4953, -0.0047, 0.4953, 0.0047, -0.25, 0.25], "atomic_number": [16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26], "y/b": [-0.125, -0.125, 0.125, 0.125, 0.374, -0.126, -0.374, 0.126, 0.126, 0.126, -0.126, -0.126, 0.131, -0.369, -0.131, 0.369, -0.103, -0.103, 0.103, 0.103, -0.119, 0.381, 0.119, -0.381, 0.144, -0.356, -0.144, 0.356, -0.378, 0.378], "label": ["S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE", "FE"], "x/a": [-0.095, 0.095, 0.095, -0.095, -0.151, -0.349, 0.151, 0.349, 0.146, -0.146, -0.146, 0.146, -0.399, -0.101, 0.399, 0.101, 0.1268, -0.1268, -0.1268, 0.1268, -0.256, -0.244, 0.256, 0.244, 0.361, 0.139, -0.361, -0.139, -2.775557561563e-17, 2.775557561563e-17], "assym": [true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "id": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]}, "lattice_vectors": {"a": [5.9328, 3.4241, 0.0], "c": [-6.06811786632, 7.89640009622e-16, 11.3789104575], "b": [-5.9328, 3.4241, 0.0]}, "volume": 924.62752781, "lattice_parameters": {"a": 11.8656, "c": 12.8958, "b": 6.8482, "beta": 118.07, "alpha": 90.0, "gamma": 90.0}}}, "meta": {"converged": true, "input": "/export111/work/ea808/crystal/corrosion/fes_phases/ehsan/pyrrhotite_B3LYP_AFM_SL12_fullOPT.d12", "start date": "Thu Aug 18 20:03:15 BST 2016"}, "optimised": {"energy": -24062.2939637, "primitive": {"geometry": {"z/c": [0.38307658148, 0.11692341852, -0.38307658148, -0.11692341852, -0.3755423277076, -0.1244576722924, 0.3755423277076, 0.1244576722924, 0.3664575750983, 0.1335424249017, -0.3664575750983, -0.1335424249017, -0.3776138650658, -0.1223861349342, 0.3776138650658, 0.1223861349342, 0.4739328797413, 0.02606712025869, -0.4739328797413, -0.02606712025869, -0.241739810435, -0.258260189565, 0.241739810435, 0.258260189565, 0.4940850729729, 0.005914927027098, -0.4940850729729, -0.005914927027098, -0.25, 0.25], "atomic_number": [16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26], "y/b": [-0.0124284319204, -0.2383936815522, 0.0124284319204, 0.2383936815522, -0.4737528084911, 0.2374230900525, 0.4737528084911, -0.2374230900525, -0.01633589153966, 0.2594267358455, 0.01633589153966, -0.2594267358455, -0.4863432326908, -0.2661471792202, 0.4863432326908, 0.2661471792202, -0.2277829825705, -0.05041120243124, 0.2277829825705, 0.05041120243124, 0.1213783655427, -0.3730554643315, -0.1213783655427, 0.3730554643315, -0.2043473520746, 0.4691641695425, 0.2043473520746, -0.4691641695425, -0.3886891941021, 0.3886891941021], "label": ["S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "FE", "FE", "FE", "FE", "FE1", "FE1", "FE1", "FE1", "FE", "FE", "FE", "FE", "FE1", "FE1"], "y": [-0.8836741344661, -0.8836741344661, 0.8836741344661, 0.8836741344661, 2.690495131124, -0.8326158188307, -2.690495131124, 0.8326158188307, 0.8564360154075, 0.8564360154075, -0.8564360154075, -0.8564360154075, 0.8720037400152, -2.651107209939, -0.8720037400152, 2.651107209939, -0.9801089793933, -0.9801089793933, 0.9801089793933, 0.9801089793933, -0.8866863425953, 2.636424607359, 0.8866863425953, -2.636424607359, 0.9329790293533, -2.590131920601, -0.9329790293533, 2.590131920601, -2.73879031174, 2.73879031174], "x/a": [-0.2383936815522, -0.0124284319204, 0.2383936815522, 0.0124284319204, 0.2374230900525, -0.4737528084911, -0.2374230900525, 0.4737528084911, 0.2594267358455, -0.01633589153966, -0.2594267358455, 0.01633589153966, -0.2661471792202, -0.4863432326908, 0.2661471792202, 0.4863432326908, -0.05041120243124, -0.2277829825705, 0.05041120243124, 0.2277829825705, -0.3730554643315, 0.1213783655427, 0.3730554643315, -0.1213783655427, 0.4691641695425, -0.2043473520746, -0.4691641695425, 0.2043473520746, -0.3886891941021, 0.3886891941021], "assym": [true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "x": [-3.798865983614, 0.7458550710501, 3.798865983614, -0.7458550710501, 0.4271937318726, -3.834432874484, -0.4271937318726, 3.834432874484, -0.4561024227537, -2.59690848981, 0.4561024227537, 2.59690848981, -2.73200998703, -0.6752291555814, 2.73200998703, 0.6752291555814, -1.747978454915, -1.305032457649, 1.747978454915, 1.305032457649, -1.718097618207, -1.689141524404, 1.718097618207, 1.689141524404, 1.334158605646, 2.073080536965, -1.334158605646, -2.073080536965, 1.526505456282, -1.526505456282], "z": [4.317560142601, 1.397784241252, -4.317560142601, -1.397784241252, -4.371020277894, -1.615467720269, 4.371020277894, 1.615467720269, 4.263633762998, 1.451710620855, -4.263633762998, -1.451710620855, -4.527825426453, -1.45866257171, 4.527825426453, 1.45866257171, 5.465472470649, 0.2498719132039, -5.465472470649, -0.2498719132039, -2.897315111516, -3.089172886647, 2.897315111516, 3.089172886647, 5.830351042173, 0.1561369559898, -5.830351042173, -0.1561369559898, -2.857672191926, 2.857672191926], "id": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]}, "volume": 531.994803, "lattice_parameters": {"a": 7.36346796, "c": 12.95932669, "b": 7.36346796, "beta": 112.389094, "alpha": 67.610906, "gamma": 122.830506}, "density": 4.041}, "crystallographic": {"geometry": {"z/c": [0.38307658148, 0.11692341852, -0.38307658148, -0.11692341852, -0.3755423277076, -0.1244576722924, 0.3755423277076, 0.1244576722924, 0.3664575750983, 0.1335424249017, -0.3664575750983, -0.1335424249017, -0.3776138650658, -0.1223861349342, 0.3776138650658, 0.1223861349342, 0.4739328797413, 0.02606712025869, -0.4739328797413, -0.02606712025869, -0.241739810435, -0.258260189565, 0.241739810435, 0.258260189565, 0.4940850729729, 0.005914927027098, -0.4940850729729, -0.005914927027098, -0.25, 0.25], "atomic_number": [16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26], "y/b": [-0.1254110567363, -0.1254110567363, 0.1254110567363, 0.1254110567363, 0.3818351407807, -0.1181648592193, -0.3818351407807, 0.1181648592193, 0.1215454221529, 0.1215454221529, -0.1215454221529, -0.1215454221529, 0.1237547940445, -0.3762452059555, -0.1237547940445, 0.3762452059555, -0.1390970925009, -0.1390970925009, 0.1390970925009, 0.1390970925009, -0.1258385493944, 0.3741614506056, 0.1258385493944, -0.3741614506056, 0.132408408734, -0.367591591266, -0.132408408734, 0.367591591266, -0.3886891941021, 0.3886891941021], "label": ["S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "FE", "FE", "FE", "FE", "FE1", "FE1", "FE1", "FE1", "FE", "FE", "FE", "FE", "FE1", "FE1"], "x/a": [-0.1129826248159, 0.1129826248159, 0.1129826248159, -0.1129826248159, -0.1444120507282, -0.3555879492718, 0.1444120507282, 0.3555879492718, 0.1378813136926, -0.1378813136926, -0.1378813136926, 0.1378813136926, -0.3899019732647, -0.1100980267353, 0.3899019732647, 0.1100980267353, 0.08868589006964, -0.08868589006964, -0.08868589006964, 0.08868589006964, -0.2472169149371, -0.2527830850629, 0.2472169149371, 0.2527830850629, 0.3367557608086, 0.1632442391914, -0.3367557608086, -0.1632442391914, 0.0, 0.0], "assym": [true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false], "id": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]}, "lattice_vectors": {"a": [6.46025005517, 3.52311094995, 0.27114361431], "c": [-6.10602182513, 7.93745897256e-16, 11.4306887677], "b": [-6.46025005517, 3.52311094995, -0.27114361431]}, "volume": 1063.98960509, "lattice_parameters": {"a": 12.93187529, "c": 12.95932669, "b": 7.0462219, "beta": 115.706795, "alpha": 90.0, "gamma": 90.0}}}}))
            });</script>



### Nested Dict Manipulation


```python
jdict2 = ejson.json_to_dict(path,['dir1','file1'])
ejson.dict_pprint(jdict2,depth=1)
```

    initial: {...}
    meta: {...}
    optimised: {...}
    units: {...}



```python
filtered = ejson.dict_filter_keys(jdict2,['vol*'],use_wildcards=True)
ejson.dict_pprint(filtered)
```

    initial: 
      crystallographic: 
        volume: 924.62752781
      primitive: 
        volume: 462.313764
    optimised: 
      crystallographic: 
        volume: 1063.98960509
      primitive: 
        volume: 531.994803



```python
ejson.dict_pprint(ejson.dict_flatten(filtered))
```

    ('initial', 'crystallographic', 'volume'):   924.62752781
    ('initial', 'primitive', 'volume'):          462.313764
    ('optimised', 'crystallographic', 'volume'): 1063.98960509
    ('optimised', 'primitive', 'volume'):        531.994803


### Units Schema


```python
from jsonextended.units import apply_unitschema, split_quantities
withunits = apply_unitschema(filtered,{'volume':'angstrom^3'})
ejson.dict_pprint(withunits)
```

    initial: 
      crystallographic: 
        volume: 924.62752781 Å ** 3
      primitive: 
        volume: 462.313764 Å ** 3
    optimised: 
      crystallographic: 
        volume: 1063.98960509 Å ** 3
      primitive: 
        volume: 531.994803 Å ** 3



```python
newunits = apply_unitschema(withunits,{'volume':'nm^3'})
ejson.dict_pprint(newunits)
```

    initial: 
      crystallographic: 
        volume: 0.92462752781 nm ** 3
      primitive: 
        volume: 0.462313764 nm ** 3
    optimised: 
      crystallographic: 
        volume: 1.06398960509 nm ** 3
      primitive: 
        volume: 0.531994803 nm ** 3



```python
ejson.dict_pprint(split_quantities(newunits),depth=4)
```

    initial: 
      crystallographic: 
        volume: 
          magnitude: 0.92462752781
          units:     nanometer ** 3
      primitive: 
        volume: 
          magnitude: 0.462313764
          units:     nanometer ** 3
    optimised: 
      crystallographic: 
        volume: 
          magnitude: 1.06398960509
          units:     nanometer ** 3
      primitive: 
        volume: 
          magnitude: 0.531994803
          units:     nanometer ** 3

